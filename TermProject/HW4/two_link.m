function dydt = two_link(t, y)

global Iz1 Iz2 L1 L2 g m1 m2 r1 r2 tau1 tau2

th1 = y(1);
dth1 = y(2);
th2 = y(3);
dth2 = y(4);

et1 = -((-tau2+g.*m2.*cos(th1+th2).*(-L1+L2+r2)+L1.*dth2.^2.*m2.*r2.*sin(th2)).*(Iz1+Iz2-L1.^2.*m1+L1.^2.*m2-L2.^2.*m2+L1.*m1.*r1.*2.0+L2.*m2.*r2.*2.0+L1.*m2.*r2.*cos(th2).*2.0))./(Iz1.*Iz2-L1.^2.*L2.^2.*m2.^2-Iz2.*L1.^2.*m1-Iz1.*L2.^2.*m2+Iz2.*L1.^2.*m2+L1.^2.*L2.^2.*m1.*m2+L1.^2.*L2.*m2.^2.*r2.*2.0+Iz2.*L1.*m1.*r1.*2.0+Iz1.*L2.*m2.*r2.*2.0-L1.^2.*m2.^2.*r2.^2.*cos(th2).^2-L1.*L2.^2.*m1.*m2.*r1.*2.0-L1.^2.*L2.*m1.*m2.*r2.*2.0+L1.*L2.*m1.*m2.*r1.*r2.*4.0);
et2 = -((Iz2-L2.^2.*m2+L2.*m2.*r2.*2.0+L1.*m2.*r2.*cos(th2)).*(tau1-g.*m2.*(L2.*cos(th1+th2)+L1.*cos(th1))-L1.*g.*m1.*cos(th1)+g.*m2.*cos(th1+th2).*(L1-r2)+g.*m1.*cos(th1).*(L1-r1)+L1.*dth2.*m2.*r2.*sin(th2).*(dth1.*2.0+dth2)))./(Iz1.*Iz2-L1.^2.*L2.^2.*m2.^2-Iz2.*L1.^2.*m1-Iz1.*L2.^2.*m2+Iz2.*L1.^2.*m2+L1.^2.*L2.^2.*m1.*m2+L1.^2.*L2.*m2.^2.*r2.*2.0+Iz2.*L1.*m1.*r1.*2.0+Iz1.*L2.*m2.*r2.*2.0-L1.^2.*m2.^2.*r2.^2.*cos(th2).^2-L1.*L2.^2.*m1.*m2.*r1.*2.0-L1.^2.*L2.*m1.*m2.*r2.*2.0+L1.*L2.*m1.*m2.*r1.*r2.*4.0);
et3 = Iz2.*tau1-Iz2.*tau2-L2.^2.*m2.*tau1+L2.^2.*m2.*tau2+L2.*m2.*r2.*tau1.*2.0-L2.*m2.*r2.*tau2.*2.0+L1.*L2.^2.*g.*m2.^2.*cos(th1)-Iz2.*L1.*g.*m2.*cos(th1)+(L1.^2.*dth2.^2.*m2.^2.*r2.^2.*sin(th2.*2.0))./2.0-Iz2.*g.*m1.*r1.*cos(th1)-L1.*m2.*r2.*tau2.*cos(th2)+L1.*g.*m2.^2.*r2.^2.*cos(th1+th2).*cos(th2)-L1.^2.*g.*m2.^2.*r2.*cos(th1+th2).*cos(th2)+L1.*L2.*dth2.^2.*m2.^2.*r2.^2.*sin(th2).*4.0-L1.*L2.^2.*dth2.^2.*m2.^2.*r2.*sin(th2).*2.0-L1.*L2.*g.*m2.^2.*r2.*cos(th1).*2.0+Iz2.*L1.*dth2.^2.*m2.*r2.*sin(th2).*2.0+L2.^2.*g.*m1.*m2.*r1.*cos(th1);
et4 = L1.*L2.*g.*m2.^2.*r2.*cos(th1+th2).*cos(th2)+L1.*L2.*dth1.*dth2.*m2.^2.*r2.^2.*sin(th2).*4.0-L1.*L2.^2.*dth1.*dth2.*m2.^2.*r2.*sin(th2).*2.0+Iz2.*L1.*dth1.*dth2.*m2.*r2.*sin(th2).*2.0-L2.*g.*m1.*m2.*r1.*r2.*cos(th1).*2.0;
dydt = [dth1;(et3+et4)./(Iz1.*Iz2-L1.^2.*L2.^2.*m2.^2-Iz2.*L1.^2.*m1-Iz1.*L2.^2.*m2+Iz2.*L1.^2.*m2+L1.^2.*L2.^2.*m1.*m2+L1.^2.*L2.*m2.^2.*r2.*2.0+Iz2.*L1.*m1.*r1.*2.0+Iz1.*L2.*m2.*r2.*2.0-L1.^2.*m2.^2.*r2.^2.*cos(th2).^2-L1.*L2.^2.*m1.*m2.*r1.*2.0-L1.^2.*L2.*m1.*m2.*r2.*2.0+L1.*L2.*m1.*m2.*r1.*r2.*4.0);dth2;et1+et2];
